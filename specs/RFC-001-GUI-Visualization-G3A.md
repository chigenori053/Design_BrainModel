# RFC-001: 因果グラフ可視化プロトコル (G3-A)

## 1. 背景と目的
現在の DesignBrainModel は、分析結果を数値（Stability/Ambiguity）とテキスト（Explanation）で出力する。しかし、どの要件がどの概念に影響を与えているか、概念同士がどのように結合しているかという「設計の構造」は、数値だけでは直感的に理解しにくい。
本仕様では、これらを 2D グラフとして可視化するためのデータ構造と GUI 実装方針を定義する。

## 2. グラフ定義
グラフは以下の 2 種類のノードと 2 種類のエッジで構成される。

### 2.1 ノード (Nodes)
- **L1 Node**: `SemanticUnitL1V2` を表現。
  - 色: 曖昧性（Ambiguity）に応じたグラデーション（青：明確 〜 黄：不明確）。
  - ラベル: `L1-<ID>`。
- **L2 Node**: `ConceptUnitV2` を表現。
  - 色: 安定性（Stability）に応じたグラデーション（緑：安定 〜 赤：不安定）。
  - ラベル: `L2-<ID>`。

### 2.2 エッジ (Edges)
- **Mapping Edge (L1 -> L2)**: L1 がどの L2 に統合されたかを示す。
  - 線種: 実線。
- **Causal Edge (L2 -> L2)**: L2 間の因果関係（Causal Links）を示す。
  - 線種: 矢印付き破線（重みに応じた太さ）。

## 3. GUI 実装仕様 (egui)
### 3.1 レイアウトアルゴリズム
動的な物理シミュレーションは避け、以下の「層状レイアウト（Layered Layout）」を基本とする。
- 左列: L1 ノード群（ID順に配置）。
- 右列: L2 ノード群（ID順に配置）。
- 中央領域: エッジを描画。

### 3.2 インタラクション
- **Hover**: ノードにマウスを重ねると、接続されているすべてのエッジを強調表示。
- **Click**: ノードをクリックすると、別パネル（または既存のリスト）に該当する `SemanticUnit` または `ConceptUnit` の詳細を表示。

## 4. データモデル拡張 (JSON Schema v1.1)
`analyze` および `session` の `data` フィールドに `graph` オブジェクトを追加する。

```json
"graph": {
  "nodes": [
    { "id": "L1-1", "type": "L1", "label": "...", "score": 0.3 },
    { "id": "L2-1", "type": "L2", "label": "...", "score": 0.9 }
  ],
  "edges": [
    { "from": "L1-1", "to": "L2-1", "type": "mapping" },
    { "from": "L2-1", "to": "L2-2", "type": "causal", "weight": 0.8 }
  ]
}
```

## 5. 検証条件 (Success Criteria)
- [ ] GUI 上にノードが表示されること。
- [ ] L1 から L2 への線が正しく引かれていること。
- [ ] ノードをクリックした際に詳細が表示されること。
- [ ] `design --json analyze` にグラフデータが含まれていること。
